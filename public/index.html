<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index</title>
    <script>
      function handleSearch(event) {
        event.preventDefault();

        const title = document.getElementById('title').value;
        const type = document.getElementById('typeSelect').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        const fetchUrl = `api/activity/search?title=${title}&type=${type}&startDate=${startDate}&endDate=${endDate}`;

        fetch(fetchUrl)
          .then((response) => response.json())
          .then((data) => {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';

            data.forEach((item) => {
              const div = document.createElement('div');
              div.className = 'activity-item';
              div.innerHTML = `
              <h2>${item.title}</h2>
              <p><strong>Location:</strong> ${item.location}</p>
              <p><strong>Start:</strong> ${new Date(item.start_from).toLocaleString()}</p>
              <p><strong>End:</strong> ${new Date(item.end_at).toLocaleString()}</p>
              <p><strong>Attendee Limit:</strong> ${item.attendees_limit}</p>
              <p><strong>Note:</strong> ${item.note}</p>`;
              resultsContainer.appendChild(div);
            });
          })
          .catch((error) => {
            console.error('Error fetching the search results:', error);
          });
      }

      function populateActivityTypes() {
        fetch('api/activity/types')
          .then((response) => response.json())
          .then((types) => {
            const typeSelect = document.getElementById('typeSelect');
            types.forEach((type) => {
              const option = document.createElement('option');
              option.value = type.id;
              option.textContent = type.name;
              typeSelect.appendChild(option);
            });
          })
          .catch((error) => console.error('Error loading activity types:', error));
      }

      window.onload = populateActivityTypes;
    </script>
  </head>
  <body>
    <form onsubmit="handleSearch(event)">
      <input type="text" id="title" name="title" placeholder="Enter search terms..." />
      <button type="submit">Search</button>
    </form>

    <div id="filters">
      <select id="typeSelect">
        <option value="">Select Type</option>
      </select>
      <input type="date" id="startDate" />
      <input type="date" id="endDate" />
    </div>
    <div id="searchResults"></div>
  </body>
</html>
