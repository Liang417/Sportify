<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  </head>
  <body class="bg-gray-100">
    <div id="userList" class="max-w-md mx-auto mt-8"></div>
    <script>
      let currentUser;
      fetch('/api/user')
        .then((response) => response.json())
        .then((data) => (currentUser = data.user))
        .catch((error) => console.error('Error:', error));

      fetch('/api/users')
        .then((response) => response.json())
        .then((data) => displayUsers(data.users))
        .catch((error) => console.error('Error:', error));

      function displayUsers(users) {
        const userListDiv = document.getElementById('userList');
        userListDiv.innerHTML = '';
        const ul = document.createElement('ul');
        ul.className = 'grid grid-cols-1 gap-4';

        users.forEach((user) => {
          if (user.id !== currentUser.id) {
            const li = document.createElement('li');
            li.className = 'bg-white p-4 rounded-md shadow-md flex items-center justify-between';

            // Create an image element for the avatar
            const avatarImg = document.createElement('img');
            avatarImg.src = `/uploads/${user.avatar}`; // Assuming the user object has an 'avatar' property
            avatarImg.className = 'w-12 h-12 object-cover rounded-full';

            // Create a div for user info
            const userInfoDiv = document.createElement('div');
            userInfoDiv.className = 'ml-4';

            // Create a span for the user name
            const userNameSpan = document.createElement('span');
            userNameSpan.className = 'text-lg font-semibold';
            userNameSpan.textContent = user.name;

            // Create a span for the user email
            const userEmailSpan = document.createElement('span');
            userEmailSpan.className = 'text-gray-500';
            userEmailSpan.textContent = user.email;

            // Append the spans to the user info div
            userInfoDiv.appendChild(userNameSpan);
            userInfoDiv.appendChild(document.createElement('br'));
            userInfoDiv.appendChild(userEmailSpan);

            // Append the image and user info to the list item
            li.appendChild(avatarImg);
            li.appendChild(userInfoDiv);

            // Add a click event listener to redirect to the chatroom.html
            li.addEventListener('click', () => {
              window.location.href = `/chatroom.html?userId=${user.id}`;
            });

            // Append the list item to the unordered list
            ul.appendChild(li);
          }
        });

        // Append the unordered list to the user list div
        userListDiv.appendChild(ul);
      }
    </script>
  </body>
</html>
